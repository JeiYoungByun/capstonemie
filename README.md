# 지능형 스마트 미러: 사용자 이력과 상황에 반응하다

## 📝 프로젝트 소개

**"당신의 습관을 기억하고, 상황에 맞춰 스스로 변하는 거울"**

본 프로젝트는 단순한 정보 나열을 넘어, 사용자의 **상태와 맥락을 이해하는** 지능형 스마트 미러를 개발합니다. 자체 개발한 AI 모듈은 거울 앞에 서는 사용자를 인식할 뿐만 아니라, **'언제, 얼마나 머물고, 무엇을 주로 보는지'** 와 같은 \*\*사용 이력(History)\*\*을 학습합니다.

이를 통해, 사용자가 자리를 비우면 자동으로 **[가족 공용 모드]** 로 전환되어 소통의 장이 되고, 다시 사용자가 나타나면 과거의 이력을 바탕으로 가장 필요할 정보를 동적으로 우선순위화하여 보여주는 **완벽한 개인화**를 구현합니다.

### 핵심 기능

  - **자동 모드 전환**: 사용자가 30초 이상 감지되지 않으면, 자동으로 [가족 공용 모드](날씨, 공유 캘린더, 디지털 액자 등)로 전환됩니다.
  - **사용 이력 기반 동적 UI**: 사용자의 과거 행동 패턴(자주 본 뉴스 카테고리, 머무는 시간 등)을 로컬 DB에 기록하고, 이를 바탕으로 정보의 위치나 순서를 동적으로 재구성합니다.
  - **연속적 상황인지**: 얼굴 인식을 일회성 '로그인'이 아닌, 사용자가 머무는 동안의 '세션(Session)'으로 관리하여 지속적인 사용자 경험을 제공합니다.
  - **오픈소스 기반의 안정성**: 검증된 MagicMirror² 플랫폼 위에서 모든 기능을 모듈 형태로 구현하여 안정성과 확장성을 확보합니다.

<br/>

## 🤔 우리가 해결하려는 문제: 살아있지 않던 '죽은 공간'의 문제

기존 스마트 미러는 두 가지의 명확한 한계를 가집니다. 바로 **'사용자가 없을 때의 활용성 부재'** 와 **'사용자의 습관을 반영하지 못하는 정적인 화면'** 입니다.

  - **고객의 애로사항 (Pain Points)**:

    1.  **나만을 위한 '고독한 스크린'**: 개인화 기능은 오직 나에게만 초점이 맞춰져 있습니다. 내가 자리를 비우는 순간, 스마트 미러는 아무 의미 없는 검은 화면이 되거나, 마지막에 보던 화면을 띄워놓은 채 방치됩니다. 이는 가족 구성원 전체를 위한 소통의 도구가 아닌, 한 사람만을 위한 고립된 장치로 전락하게 만듭니다.
    2.  **변화 없는 '앵무새 같은 정보'**: 매일 아침, 스마트 미러는 어제와 똑같은 위치에, 똑같은 순서로 정보를 나열합니다. 내가 출근 전 10초 동안 날씨만 빠르게 확인하는 습관이 있더라도, 미러는 여전히 주식, 뉴스, 캘린더를 모두 보여주며 나의 집중력을 분산시킵니다. 사용자의 습관에 맞춰 스스로 진화하지 못하는 것입니다.

  - **우리의 해결책 (Solution)**:
    저희 스마트 미러는 **'상태'** 라는 개념을 도입하여 이 문제를 해결합니다.

      - **상황에 맞는 역할 변화**: 사용자가 없다는 '부재 상태'를 인지하면, 미러는 스스로 **[가족을 위한 디지털 게시판]** 으로 역할을 전환합니다. 오늘의 가족 공유 일정, 추억이 담긴 사진들을 보여주며 거실이나 현관의 '죽은 공간'을 살아있는 소통의 허브로 만듭니다.
      - **당신의 습관을 기억하는 비서**: '사용자 A 접속 상태'가 되면, 미러는 "A님은 지난 일주일간 아침 8시에는 날씨 정보를 80% 확률로, 뉴스 정보를 20% 확률로 확인했습니다" 와 같은 **사용 이력**을 바탕으로 날씨 위젯을 가장 잘 보이는 곳에 동적으로 배치합니다. 사용자의 행동에 따라 스스로 진화하며, 가장 효율적인 정보 동선을 제공하는 **'학습형 개인 비서'** 가 되는 것입니다.

<br/>

## 🔬 선행 특허 기술 분석 및 차별점

본 아이디어의 독창성을 검증하기 위해, '스마트 미러'와 '사용자 인식' 분야의 주요 선행 특허를 분석했습니다. 기존 특허들은 대부분 얼굴 인식을 **정적인 정보를 불러오기 위한 일회성 스위치**로 활용하는 데 그칩니다.

### 선행 특허 사례

1.  **US 10,810,912 B2 (AMAZON TECHNOLOGIES, INC.)**:

      - **특허 내용**: 얼굴 인식을 통해 특정 사용자를 식별하고, 해당 사용자 계정에 연동된 **디지털 음성 비서를 활성화**하는 기술입니다. 즉, 얼굴은 '알렉사, 시작해'라는 명령을 내리기 위한 '열쇠' 역할에 가깝습니다.
      - **한계**: 사용자를 인식하여 특정 기능(음성 비서)을 '깨우는' 단발성 트리거이며, 사용자가 자리를 비우거나 다시 돌아왔을 때의 연속적인 상태 변화나 정보의 동적 재구성에 대한 개념은 다루지 않습니다.

2.  **US 2014/0320625 A1 (GOOGLE INC.)**:

      - **특허 내용**: 가정 내 컴퓨팅 기기(스마트 디스플레이 등)가 사용자를 인식하여, 해당 사용자의 **기본 설정(Pre-set) 프로필**을 불러오는 기술에 중점을 둡니다. 아빠를 인식하면 아빠의 배경화면과 위젯 목록을, 엄마를 인식하면 엄마의 것을 보여주는 방식입니다.
      - **한계**: 미리 정해둔 '고정된' 프로필을 로딩하는 방식입니다. 사용자의 이용 습관이나 패턴이 변하더라도 이를 학습하여 정보의 우선순위를 동적으로 바꾸지는 못합니다.

3.  **KR 10-2018-0099496 A (LG ELECTRONICS INC.)**:

      - **특허 내용**: 의류 관리기(스타일러)에 부착된 거울 디스플레이가 사용자를 인식하고, 해당 사용자의 기존 의류 관리 이력이나 선호하는 스타일 정보를 표시해주는 기술입니다.
      - **한계**: '의류 관리'라는 매우 특정한 도메인에 한정되어 있으며, 얼굴 인식은 저장된 정보를 '조회'하기 위한 수단으로 사용됩니다. 사용자의 부재 시 공용 모드로 전환되는 등, 미러의 역할 자체가 상황에 따라 변하는 동적인 개념은 포함하지 않습니다.

### 우리 프로젝트의 명확한 차별점

위 특허들과 달리, 저희 프로젝트는 **"상시 감지 + 상태 전이 이력 관리 + 자동 모드 전환"** 이라는 연속적인 서비스 흐름(Service Flow)을 핵심으로 합니다.

  - **차별점**: 저희는 얼굴 인식을 단순히 '정보 로딩'의 스위치로 보지 않습니다. 대신, **사용자의 등장(Login), 상호작용(Interaction), 퇴장(Logout)으로 이어지는 하나의 '세션(Session)'** 으로 정의합니다. 이 세션들의 \*\*이력(History)\*\*을 **SQLite**와 같은 경량 DB에 축적하고, 이 데이터를 기반으로 다음에 보여줄 정보의 우선순위를 동적으로 결정합니다. 또한, '로그아웃(퇴장)' 상태가 감지되면 시스템은 자동으로 **[가족 공용 모드]** 라는 또 다른 상태로 스스로 '전이(Transition)'합니다. 이처럼 **연속적이고 상황 반응적인 상태 변화를 관리하고, 그 이력을 다음 정보 제시에 활용하는 시스템**은 선행 특허에서 찾아보기 힘든 독창적인 컨셉입니다.

<br/>

## 🖥️ 화면 구성 (상황인지 기반 자동 전환)

| **가족 공용 모드 (사용자 부재 시)** | **사용자 A 인식 시 (동적 UI 적용)** |
| :---: | :---: |
| - **중앙**: 가족사진 디지털 액자 (Google Photos)<br>- **상단**: 현재 날씨 및 시간 (공용 정보)<br>- **캘린더**: '가족' 공유 캘린더 (공동 일정)<br>- **하단**: 가족 메모 보드 | - **상단 좌측 (우선순위 1)**: 날씨 위젯 (최근 7일간 아침에 가장 많이 확인한 정보)<br>- **상단 우측**: 출근길 교통 정보<br>- **캘린더**: '업무' 개인 캘린더<br>- **하단**: 경제 뉴스 (과거 클릭 빈도가 높은 카테고리) |


<br/>

## ⚙️ 기술 스택 (Tech Stack)

### Hardware

  - **Raspberry Pi 4**, **USB Webcam**, **Display & Half Mirror**

### Core Software & Platform

  - **Raspberry Pi OS**: Debian 기반의 안정적인 운영체제
  - **MagicMirror²**: 프로젝트의 핵심 프레임워크
  - **Node.js**: MagicMirror²의 런타임 환경
  - **Python**: **'사용자 인식 및 상태 관리 API'** 서버 구축
  - **face\_recognition (Dlib)**: 라즈베리파이 환경에 최적화된 고정확도 얼굴 인식 라이브러리
  - **SQLite**: **사용자 상태 전이 이력(로그인/아웃, 위젯 사용 빈도 등)** 을 저장하고 관리하기 위한 경량 로컬 데이터베이스

### APIs & Tools

  - **자체 개발 API**:
      - **사용자 상태 관리 API (User Status Management API)**:
        1.  실시간으로 사용자를 감지하고 ID를 식별.
        2.  사용자의 등장/퇴장 시간을 타임스탬프와 함께 SQLite에 기록.
        3.  MagicMirror²로부터 특정 위젯 상호작용 정보를 받아 DB에 기록.
        4.  MagicMirror²에 현재 사용자 ID와 정보 우선순위 데이터를 전송.
  - **외부 API**: OpenWeatherMap API, Google Calendar API, NewsAPI
  - **Tools**: Git, Github, SSH, PM2

<br/>

## 🛠️ 프로젝트 아키텍처

**SQLite** 데이터베이스를 중심으로, 두 서버가 유기적으로 상태 정보를 주고받는 구조입니다.

  - **Python AI & DB Server**: 얼굴 인식을 수행하며, 사용자의 상태 변화(등장, 퇴장)를 감지하여 **SQLite**에 직접 기록합니다. 또한, Node.js 서버의 요청에 따라 특정 사용자의 이력 데이터를 조회하여 제공하는 역할도 담당합니다.

  - **Node.js Main Server (MagicMirror²)**: UI를 제어합니다. AI 서버로부터 현재 사용자 ID를 받으면, 다시 AI 서버(또는 직접 DB)에 해당 사용자의 **이력 데이터**를 요청합니다. 받은 이력 데이터를 바탕으로 모듈의 위치나 순서를 재구성하여 화면에 표시합니다.

> **데이터 흐름 예시 (상태 전이)**:
>
> 1.  카메라에 아무도 없음. **AI 서버**는 30초 이상 '부재(absence)' 상태를 확인하고, **메인 서버**에 `CHANGE_MODE: 'public'` 알림을 보냅니다. 메인 서버는 [가족 공용 모드]를 표시합니다.
> 2.  사용자 A가 등장. **AI 서버**가 A를 인식하고, `(Timestamp, UserID: 'A', Event: 'LOGIN')` 정보를 **SQLite**에 기록합니다.
> 3.  동시에 **메인 서버**에 `USER_DETECTED: 'A'` 알림을 보냅니다.
> 4.  **메인 서버**는 **AI 서버(또는 DB)** 에 "A의 이력 데이터 줘"라고 요청합니다.
> 5.  요청 결과를 바탕으로 "날씨 위젯을 (x,y) 좌표에, 뉴스 위젯을 (x',y') 좌표에 표시해" 와 같이 동적으로 화면을 구성합니다.

<br/>

## 🤔 기술적 이슈와 해결 과정

(기존 내용과 더불어 아래 내용이 추가 또는 강화됩니다.)

### 사용자 상태 및 이력 관리 구현

  - **문제점**: '상태 전이', '사용 이력'과 같은 추상적인 개념을 어떻게 코드로 구현하고 데이터를 관리할 것인가?
  - **해결 과정**:
    1.  **DB 스키마 설계**: **SQLite**에 `history` 라는 간단한 테이블을 설계했습니다. `(id INTEGER PRIMARY KEY, timestamp TEXT, user_id TEXT, event_type TEXT, event_detail TEXT)` 와 같은 구조로, `event_type`에는 'LOGIN', 'LOGOUT', 'INTERACTION' 등을, `event_detail`에는 위젯 이름 등을 기록하여 모든 상태 변화를 로그로 남겼습니다.
    2.  **상태 전이 로직**: Python 서버 내에 간단한 상태 머신(State Machine)을 구현했습니다. 'PUBLIC\_MODE', 'USER\_A\_MODE', 'USER\_B\_MODE' 등의 상태를 정의하고, 얼굴 인식 결과(ID 또는 None)와 타이머를 조합하여 상태가 변경될 때마다 MagicMirror²로 알림을 보내도록 설계했습니다. 이를 통해 복잡한 로직을 단순화할 수 있었습니다.

<br/>

## 💁‍♂️ 프로젝트 팀원

| Project Lead & Developer |
| :---: |
| (팀원 정보) |
